<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>mTree - Developer Server</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>

    <script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.4/ace.js"></script>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
      
      class MTreeConnection{
        constructor(){
          if(! MTreeConnection.instance){

            this.connect();

            this._data = [];
            MTreeConnection.instance = this;
          }

          return MTreeConnection.instance;

        }

        connect(){
          console.log("Setting up WebSocket connection");
          this.namespace = '/developer';
          this.user_id = '';
          this.socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + this.namespace);
          console.log(this.socket);
          // register
          this.socket.on('connect', () => this.connected);
          this.socket.on('log_message', (msg) => this.logMessage(msg));
          this.socket.on('system_status', (msg) => this.logMessage(msg));

          this.socket.on('mes_response', (msg) => {
              console.log("MES RESPONDING>>>>");
              console.log(msg);
            });


          this.socket.on('message', function (message) {
            console.log(message);
          });


        }

        logMessage(msg){
          console.log("LOG MESSAGE RECEIVED");
          console.log(msg);
        }

        connected(){
          console.log("Admin connected...");
          this.socket.emit('my_event', {data: 'I\'m connected!'});
          
        }

        status(){
          console.log("mTreeConnection object available");
        }

        send_status_request(){
          console.log("about to send...");
          this.socket.emit("get_system_status", {});
        }

        send_admin_message(message){
          console.log("about to send...");
          this.socket.emit("admin_mes_message", message);
        }

        send(action, data){
          this.socket.emit(action, {data: data});
        }

      }

        $(document).ready(() => {

          const mTreeConnection = new MTreeConnection();
          console.log(mTreeConnection);
          mTreeConnection.status();

            // // Use a "/test" namespace.
            // // An application can open a connection on multiple namespaces, and
            // // Socket.IO will multiplex all those connections on a single
            // // physical channel. If you don't care about multiple channels, you
            // // can set the namespace to an empty string.
            // namespace = '/developer';

            // user_id = '';

            // // Connect to the Socket.IO server.
            // // The connection URL has the following format:
            // //     http[s]://<domain>:<port>[/<namespace>]
            // var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
            // //var socket = io.connect('https://' + document.domain + namespace);

            // // Event handler for new connections.
            // // The callback function is invoked when a connection with the
            // // server is established.
            // socket.on('connect', function() {
            //     console.log("Admin connected...");
            //     socket.emit('my_event', {data: 'I\'m connected!'});
            // });

            // socket.on('admin_action', function(msg) {
            //     console.log(msg);
            //     switch(msg["action"]){
            //         case "add_user":
            //           add_user_to_list(msg);
            //           break;
            //         case "update_admin_table":
            //           update_user_list(msg);
            //           break;
            //         case "drop_user":
            //           add_user_to_inactive_list(msg);
            //           break;
            //       };
            // });

            // socket.on('willow_action', function(msg) {
            //   console.log("DOING SOMETIHG");
            //   console.log(msg);
            //   }
            //   );


            // function add_user_to_list(msg){
            //     console.log("Appending another row");
            //     new_user_record = $('<tr>').attr("id",msg["data"]["user_id"]).append(
            //       $('<td>').attr("id","user_id").text(msg["data"]["user_id"]),
            //       $('<td>').attr("id","current").text(msg["data"]["current"]),
            //       $('<td>').attr("id","join_time").text(msg["data"]["join_time"]),
            //       $('<td>').attr("id","last_contact").text("-"),
            //       $('<td>').attr("id","total_earnings").text("-"));
            //     console.log(new_user_record);

            //     $("#active_users > tbody:last").append(new_user_record);

            // }

            // function update_user_list(msg){
            //     $("#" + msg["data"]["user_id"]).find("#total_earnings").html(msg["data"]["total_earnings"]);
            //     $("#" + msg["data"]["current"]).find("#last_contact").html(msg["data"]["current"]);
            //     $("#" + msg["data"]["last_contact"]).find("#last_contact").html(msg["data"]["last_contact"]);

            // }


            // function add_user_to_inactive_list(msg){
            //     console.log("Appending another row");
            //     inactive_user_record = $('<tr>').attr("id",msg["data"]["user_id"]).append(
            //       $('<td>').attr("id","user_id").text(msg["data"]["user_id"]),
            //       $('<td>').attr("id","current").text(msg["data"]["current"]),
            //       $('<td>').attr("id","join_time").text(msg["data"]["join_time"]),
            //       $('<td>').attr("id","last_contact").text(msg["data"]["last_contact"]),
            //       $('<td>').attr("id","total_earnings").text("-"));
            //     console.log(inactive_user_record);
            //     $("#active_users").find("#" + msg["data"]["user_id"]).remove();

            //     $("#inactive_users > tbody:last").append(inactive_user_record);

            // }

            // function update_inactive_user_list(msg){
            //     $("#" + msg["data"]["user_id"]).find("#total_earnings").html(msg["data"]["total_earnings"]);
            //     $("#" + msg["data"]["user_id"]).find("#last_contact").html(msg["data"]["last_contact"]);

            // }



            // // Interval function that tests message latency by sending a "ping"
            // // message. The server then responds with a "pong" message and the
            // // round trip time is measured.
            // var ping_pong_times = [];
            // var start_time;

            // // Handler for the "pong" message. When the pong is received, the
            // // time from the ping is stored, and the average of the last 30
            // // samples is average and displayed.


            // // Handlers for the different forms in the page.
            // // These accept data from the user and send it to the server in a
            // // variety of ways
            // $('form#emit').submit(function(event) {
            //     socket.emit('my_event', {data: $('#emit_data').val()});
            //     return false;
            // });
            // $('form#broadcast').submit(function(event) {
            //     socket.emit('my_broadcast_event', {data: $('#broadcast_data').val()});
            //     return false;
            // });
            // $('form#join').submit(function(event) {
            //     socket.emit('join', {room: $('#join_room').val()});
            //     return false;
            // });
            // $('form#leave').submit(function(event) {
            //     socket.emit('leave', {room: $('#leave_room').val()});
            //     return false;
            // });
            // $('form#send_room').submit(function(event) {
            //     socket.emit('my_room_event', {room: $('#room_name').val(), data: $('#room_data').val()});
            //     return false;
            // });
            // $('#run-simulation').click((event) => {
            //     console.log("STUFF HAPPENING");

            //     socket.emit('run_simulation', {});
            //     return false;
            // });
            // $('form#disconnect').submit(function(event) {
            //     socket.emit('disconnect_request');
            //     new_user_record = $('<tr>').attr("id",msg["data"]["user_id"]).append(
            //       $('<td>').attr("id","user_id").text(msg["data"]["user_id"]),
            //       $('<td>').attr("id","join_time").text(msg["data"]["join_time"]),
            //       $('<td>').attr("id","last_contact").text("-"),
            //       $('<td>').attr("id","total_earnings").text("-"));
            //     console.log(new_user_record);

            //     $("#active_users > tbody:last").append(new_user_record);
            //     return false;
            // });

            // $('button').click(function(){
            //         var button_pressed = this.id;
            //         message = {};
            //         switch(button_pressed){
            //         case "start_experiment":
            //             message['control'] = "START";
            //             break;
            //         case "pause_experiment":
            //             message['control'] = "PAUSE";
            //             break;
            //         case "stop_experiment":
            //             message['control'] = "STOP";
            //             break;
            //         }
            //         socket.emit('admin_control', message);

            //     }
            // );

        });
    </script>
    <!-- Custom styles for this template -->
    <link href="https://getbootstrap.com/docs/5.1/examples/dashboard/dashboard.css" rel="stylesheet">
  </head>
  <body>
    <body>
    
      <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">mTree Developer Server</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
        <div class="navbar-nav">
          <div class="nav-item text-nowrap">
            <a class="nav-link px-3" href="#">Sign out</a>
          </div>
        </div>
      </header>
      
      <div class="container-fluid">
        <div class="row">
          <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
            <div class="position-sticky pt-3">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link active" href="/">
                    <span data-feather="home"></span>
                    MES Library <span class="sr-only">(current)</span>
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" href="/status">
                    <span data-feather="home"></span>
                    System Status
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" href="/simulation_builder">
                    <span data-feather="home"></span>
                    Simulation Builder
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link active" href="/simulation_library">
                    <span data-feather="home"></span>
                    Simulation Library
                  </a>
                </li>
              </ul>
            </div>
          </nav>
            
            <main role="main" class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
              {% block mesnav %}{% endblock %}
              
              {% block content %}
                 
               {% endblock %}
             </main>

        </div>
      </div>
      
        </body>




